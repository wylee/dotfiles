# SSH to the router and execute the command below
#
# TODO: Add user setup
# TODO: Add SSH setup
# TODO: Convert this to a script

ssh 192.168.1.1

# Enter config mode
configure

# Basics ---------------------------------------------------------------------

set system domain-name home.lan
set system time-zone America/Los_Angeles

# DNS ------------------------------------------------------------------------

# Delete any existing DNS services if they point at public DNS servers
# I don't think this is necessary with the default config
# delete service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server <IP>
# delete service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 dns-server <IP>

# Make DHCP to use local DNS only
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server 192.168.1.1
set service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 dns-server 192.168.2.1

# Use the local DNS server
set system name-server 127.0.0.1
set system name-server '::1'

set service dns forwarding system
set service dns forwarding except-interface eth0

# I think this is unnecessary due to the above except-interface config
# set service dns forwarding listen-on eth1
# set service dns forwarding listen-on switch0

# Forward to public DNS servers
set service dns forwarding name-server 1.1.1.1

set service dns forwarding cache-size 2048
set service dns forwarding options domain-needed
set service dns forwarding options no-hosts

# These are recommended one site, but I'm not sure what they do
# set service dns forwarding options bogus-priv
# set service dns forwarding options enable-ra
# set service dns forwarding options expand-hosts
# set service dns forwarding options localise-queries
# set service dns forwarding options strict-order
# set service dns forwarding options domain=home.local

# Enable DNS black hole
set service dhcp-server use-dnsmasq enable
set service dns forwarding options addn-hosts=/config/user-data/dnsmasq.blackhole.conf

# Save and exit config mode
commit
save
exit

reboot # ???
